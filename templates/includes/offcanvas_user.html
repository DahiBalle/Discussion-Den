<!-- Enhanced Right Offcanvas Content Component -->
<div class="offcanvas-content-enhanced">
    <!-- User Profile Summary Section -->
    <div class="offcanvas-section-enhanced">
        <div class="user-profile-summary text-center mb-4">
            <div class="user-avatar-large mb-3">
                <i class="fas fa-user-circle fa-3x"></i>
            </div>
            <h5 class="user-name-title mb-1">{{ current_user.username }}</h5>
            <p class="user-role-subtitle text-muted small">
                {% if session.get('active_persona_id') %}
                Acting as Persona
                {% else %}
                Acting as User
                {% endif %}
            </p>
        </div>
    </div>

    <!-- Preferences Section -->
    <div class="offcanvas-section-enhanced">
        <h6 class="offcanvas-section-title">
            <i class="fas fa-sliders-h me-2"></i>Preferences
        </h6>

        <!-- Theme Toggle -->
        <div class="preference-item mb-3">
            <div class="d-flex justify-content-between align-items-center p-3 bg-tertiary rounded-3">
                <div class="preference-label">
                    <i class="fas fa-moon me-2"></i>Dark Mode
                </div>
                <button class="btn btn-outline-secondary btn-sm theme-toggle-btn" type="button"
                    aria-label="Toggle theme">
                    <i class="fas fa-adjust theme-icon"></i>
                </button>
            </div>
        </div>

        <!-- Identity Switcher -->
        <div class="preference-item">
            <div class="preference-label mb-2 px-1">
                <i class="fas fa-mask me-2"></i>Switch Identity
            </div>
            <div class="identity-list d-flex flex-column gap-2">
                <!-- User Option -->
                <a href="#"
                    class="identity-option p-3 bg-tertiary rounded-3 text-decoration-none d-flex align-items-center justify-content-between persona-switch-option {% if not session.get('active_persona_id') %}active-identity{% endif %}"
                    data-persona-id="null">
                    <div class="d-flex align-items-center gap-3">
                        <div class="identity-icon-box">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="identity-info">
                            <div class="identity-name">User Account</div>
                            <div class="identity-handle text-muted small">{{ current_user.username }}</div>
                        </div>
                    </div>
                    {% if not session.get('active_persona_id') %}
                    <i class="fas fa-check text-primary"></i>
                    {% endif %}
                </a>

                <!-- Personas Options -->
                {% for persona in current_user.personas %}
                <a href="#"
                    class="identity-option p-3 bg-tertiary rounded-3 text-decoration-none d-flex align-items-center justify-content-between persona-switch-option {% if session.get('active_persona_id') == persona.id|string %}active-identity{% endif %}"
                    data-persona-id="{{ persona.id }}">
                    <div class="d-flex align-items-center gap-3">
                        <div class="identity-icon-box">
                            <i class="fas fa-mask"></i>
                        </div>
                        <div class="identity-info">
                            <div class="identity-name">{{ persona.name }}</div>
                            <div class="identity-handle text-muted small">Persona</div>
                        </div>
                    </div>
                    {% if session.get('active_persona_id') == persona.id|string %}
                    <i class="fas fa-check text-primary"></i>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
            <div class="mt-3 text-center">
                <a href="{{ url_for('persona.create_persona') }}" class="btn btn-sm btn-outline-primary w-100">
                    <i class="fas fa-plus me-2"></i>Create New Persona
                </a>
            </div>
        </div>
    </div>

    <!-- Navigation Menu Section -->
    <div class="offcanvas-section-enhanced mt-4">
        <h6 class="offcanvas-section-title">
            <i class="fas fa-compass me-2"></i>Menu
        </h6>
        <div class="offcanvas-nav-links">
            <a href="{{ url_for('profile.user_profile', username=current_user.username) }}" class="offcanvas-nav-link">
                <i class="fas fa-user"></i>
                <span>My Profile</span>
            </a>
            <a href="{{ url_for('profile.user_profile', username=current_user.username, view='saved') }}"
                class="offcanvas-nav-link">
                <i class="fas fa-bookmark"></i>
                <span>Saved Posts</span>
            </a>
            <a href="{{ url_for('profile.user_profile', username=current_user.username, view='posts') }}"
                class="offcanvas-nav-link">
                <i class="fas fa-pen-fancy"></i>
                <span>My Posts</span>
            </a>
            <a href="{{ url_for('profile.edit_profile') }}" class="offcanvas-nav-link">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
            <a href="{{ url_for('auth.logout') }}" class="offcanvas-nav-link text-danger">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>
</div>

<style>
    /* Right Offcanvas Specific Styles */
    .user-avatar-large {
        color: var(--text-secondary);
    }

    .active-identity {
        border: 1px solid var(--accent-primary);
        background: var(--bg-hover) !important;
    }

    .identity-icon-box {
        width: 32px;
        height: 32px;
        background: var(--bg-secondary);
        border-radius: var(--border-radius);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
    }

    .identity-option:hover {
        background: var(--bg-hover) !important;
    }

    .bg-tertiary {
        background: var(--bg-tertiary);
    }
</style>